<ion-content>
  <div class="header">
    <ion-toolbar style="--background: transparent; opacity: 0.7;">
      <ion-buttons slot="start">
        <ion-button (click)="back()" fill="clear" shape="round">
          <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
        </ion-button>
      </ion-buttons>
      <ion-buttons slot="end">
        <ion-button (click)="onClick()" fill="clear" shape="round">
          <ion-icon slot="icon-only" name="share-social"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </div>
  <div class="flex">
    <ion-card style="height: 320px;width: 180px;" class="ion-no-margin">
      <ion-img [src]="url" style="height: 320px;width: 180px;"></ion-img>
    </ion-card>
  </div>
  <h1 class="ion-text-center ion-no-margin">{{firebase.book.title}}</h1>
  <div class="subscribe ion-no-margin">
    <p>
      {{firebase.book.view}}<ion-icon name="eye"></ion-icon>
    </p>
    <div class="ion-margin">
      <ion-icon name="star" *ngFor="let i of firebase.book.starsArray" color="primary"></ion-icon>
    </div>
    <p color="light" mode="ios">
      {{firebase.book.vote}}<ion-icon name="chatbubble"></ion-icon>
    </p>
  </div>
  <div class="subscribe">
    <ion-button (click)="play()" expand="block" fill="solid" shape="round">
      <ion-icon name="play"></ion-icon>
      Lire
    </ion-button>
    <ion-button (click)="edit()" expand="block" fill="clear" shape="round" *ngIf="isAuthor()" color="medium">
      <ion-icon name="create"></ion-icon>
      Editer
    </ion-button>
    <ion-button (click)="addToList()" expand="block" fill="clear" shape="round" *ngIf="!isAuthor() && !inList && firebase.connected" color="medium">
      <ion-icon name="list"></ion-icon>
      Ajouter à la liste
    </ion-button>
    <ion-button (click)="removeFromList()" expand="block" fill="clear" shape="round" *ngIf="!isAuthor() && inList && firebase.connected" color="medium">
      <ion-icon name="list"></ion-icon>
      Retirer de la liste
    </ion-button>
  </div>
  <div class="subscribe">
    <app-user-chip *ngFor="let author of authorsId" [userId]="author" ></app-user-chip>
  </div>
  <div class="subscribe">
    <ion-badge color="primary" mode="ios" *ngFor="let tag of firebase.book.tags" class="ion-margin-start">
      {{tag}}
    </ion-badge>
  </div>
  <ion-text color="medium" class="ion-text-center">
  <p>{{firebase.book.desc}}</p>
  </ion-text>
  <ion-button (click)="more()" expand="block" fill="clear" shape="round">
    En savoir plus
  </ion-button>
  <ion-card *ngIf="firebase.connected">
    <ion-item lines="none">
      <ion-avatar slot="start" style="width: 50px; height: 50px;">
        <ion-img [src]="firebase.userData.avatar" button ></ion-img>
      </ion-avatar>
      <ion-buttons>
        <ion-button *ngFor="let star of [0,0,0,0,0]; index as i" [color]="getStarColor(i)" (click)="setRate(i)">
          <ion-icon slot="icon-only" name="star"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-item>
    <ion-item lines="none">
      <ion-textarea [(ngModel)]="comment.text" placeholder="Laisser un avis" (keypress)="enter($event.keyCode)"></ion-textarea>
      <ion-button (click)="send()" expand="block" fill="clear" shape="round" slot="end">
        <ion-icon slot="icon-only" name="send"></ion-icon>
      </ion-button>
    </ion-item>
  </ion-card>
  <ion-grid fixed>
    <ion-row *ngFor="let comment of firebase.comments; index as commentIndex">
      <ion-col>
        <ion-avatar style="width: 50px; height: 50px;" *ngIf="comment.user | async as user">
          <ion-img [src]="user.avatar" button ></ion-img>
        </ion-avatar>
      </ion-col>
      <ion-col size="10">
        <ion-card>
          <ion-item lines="none">
            <ion-label color="primary" slot="start" *ngIf="comment.user | async as user">
                {{user.name}}<br>
                <ion-icon name="star" *ngFor="let i of starToArray(comment.rate)" color="primary"></ion-icon>
            </ion-label>
            <ion-note slot="end" class="ion-text-end">
              {{comment.date|timeAgo}} 
            </ion-note>
          </ion-item>
          <ion-item lines="none">
            <p>
              <ion-text color="medium">
                {{comment.text}}
              </ion-text>
            </p>
          </ion-item>
          <ion-button (click)="answer(comment.userId)" expand="block" fill="clear" shape="round" *ngIf="isAuthor()">
            Répondre
          </ion-button>
          <ion-button (click)="showAnswer(commentIndex)" expand="block" fill="clear" shape="round" *ngIf="commentIndex !== selectedAnswer && comment.hasOwnProperty('answer')">
            Voir la réponse du créateur
          </ion-button>
          <ion-button (click)="hideAnswer()" expand="block" fill="clear" shape="round" *ngIf="commentIndex === selectedAnswer">
            Cacher la réponse du créateur
          </ion-button>
        </ion-card>
        <ion-card *ngIf="commentIndex === selectedAnswer">
          <ion-card-content>
            <p>
              <ion-text color="medium">
                {{comment.answer}}
              </ion-text>
            </p>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
  
</ion-content>


